import{j as e,F as b,f as x}from"./vendor-font-awesome-fb8PRCmj.js";import{c as h,h as g,C as j,d as I,E as w}from"./index-lBioDFl4.js";import{P as y}from"./PageHeader-1TgteFVd.js";import{B as S}from"./Button-C3YJ6iVm.js";import{u as v}from"./useDocumentTitle-CWGRdlYI.js";import{u as N,a as E,b as k,o as F,s as c,c as A}from"./vendor-forms-CXz_4OM6.js";import{I as C}from"./InputField-B-7MhsdR.js";import{I as P,a as V}from"./InputLabel-DqjUQIAl.js";import{I as Y}from"./InputArea-Dr2i9MUp.js";import{y as u}from"./index-CcAK1yoR.js";import{a as q}from"./vendor-states-CBI6bQG0.js";import{u as B}from"./usePageLog-CpyrOzkW.js";import"./vendor-react-Cx4ePrNi.js";import"./appMeta-B1yHDSiB.js";import"./InputIcon-B7ia0x9Z.js";const H=({id:r,label:s,error:a,className:t,register:i,...m})=>{const d=!!a;return e.jsxs("div",{className:t,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:r,...i(r),...m,type:"checkbox",className:h("w-4 h-4 border rounded-md cursor-pointer","bg-white dark:bg-mono-700 text-mono-900 dark:text-mono-100 disabled:opacity-50 disabled:cursor-not-allowed",d?["border-red-500","focus:ring-2 focus:ring-red-400","focus:border-red-500"]:["border-mono-200 dark:border-mono-600","focus:ring-2 focus:ring-pink-400","focus:border-transparent"])}),s&&e.jsx(P,{htmlFor:r,className:"cursor-pointer select-none",children:s})]}),d&&e.jsx(V,{errorMessage:a?.message??""})]})};async function L(r,s){const a=await g(),{error:t}=await a.schema("blog").from("ideas").insert({name:s,text:r});if(t)throw t}const M=F({username:c(),credits:A(),idea:c().min(1,{message:"Idea text is required"})}).superRefine(({credits:r,username:s},a)=>{r&&!s&&a.addIssue({code:"custom",message:"A username is required when credits are provided",path:["username"]})}),ee=()=>{v("Submit idea"),B("Submit idea");const{register:r,control:s,reset:a,formState:{isValid:t,errors:i},handleSubmit:m}=N({resolver:E(M),defaultValues:{username:"",credits:!1,idea:""},mode:"onChange"}),d=k({control:s,name:"credits"}),{mutateAsync:l,isPending:n}=q({mutationFn:async o=>{await L(o.idea,o.credits?o.username:void 0)},onSuccess:()=>{u.success("Idea successfully submitted!"),a()},onError:o=>{I(w.ideaSubmitError,o),u.error("An error occurred while submitting your idea. Please try again later.")}}),{ref:p,...f}=r("idea");return e.jsxs("div",{className:"container mx-auto px-4 max-w-xl",children:[e.jsx(y,{title:"Share Your Idea",subtitle:"We’re excited to hear your creative ideas!"}),e.jsx(j,{className:"flex flex-col gap-4",children:e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:m(async o=>await l(o)),noValidate:!0,children:[e.jsx("div",{className:d?"block":"hidden",children:e.jsx(C,{id:"username",register:r,placeholder:"How should we credit you?",error:i.username,label:"Username (for credit)",disabled:n})}),e.jsx(H,{id:"credits",register:r,label:"Feature me as author if selected",error:i.credits,disabled:n}),e.jsx(Y,{id:"idea",...f,ref:p,error:i.idea,disabled:n}),e.jsx("p",{className:"text-sm text-gray-500",children:"I welcome all ideas, though I can’t commit to writing them. Your idea may or may not appeal to me."}),e.jsx(S,{variant:"submit",type:"submit",className:"w-full",disabled:!t||n,children:n?e.jsx(b,{icon:x,spin:!0}):"Submit Your Idea"})]})})]})};export{ee as default};
