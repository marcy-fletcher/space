import{j as o,F as g,a4 as v,a5 as R,G as _,a6 as j}from"./vendor-font-awesome-fb8PRCmj.js";import{h as x,q as k,d as q,E as y,l as p,e as b,u as H,c as h}from"./index-DVJIb8Cr.js";import{a as w,u as I}from"./vendor-states-BrjWHaJB.js";import"./vendor-react-Cx4ePrNi.js";function S(t){const e={like:{count:0,userHasReacted:!1},dislike:{count:0,userHasReacted:!1},hot:{count:0,userHasReacted:!1},sequel_request:{count:0,userHasReacted:!1}};for(const s of t){const{reaction:r,reaction_count:n,user_reacted:c}=s;e[r]&&(e[r].count+=n),c&&(e[r].userHasReacted=!0)}return e}async function C(t){const e=await x(),{data:s,error:r}=await e.schema("blog").from("reaction_counts_per_post").select("*").eq("post_id",t);if(r)throw r;return S(s)}async function E(t,e){await(await x()).schema("blog").rpc("toggle_post_reaction",{p_post_id:t,p_reaction:e})}const A=({postId:t,type:e,count:s,userReacted:r})=>{const n=["post_reactions",t];return w({mutationFn:()=>E(t,e),onMutate:async(c,m)=>{await k.cancelQueries({queryKey:n});const i=e,l=!r,d=r?s-1:s+1;return m.client.setQueryData(n,a=>{if(i==="like"&&a?.dislike.userHasReacted||i==="dislike"&&a?.like.userHasReacted){const f=i==="like"?"dislike":"like";return{...a,[i]:{userHasReacted:l,count:d},[f]:{userHasReacted:!1,count:a[f].count-1}}}return{...a,[i]:{userHasReacted:l,count:d}}}),{optimisticReacted:l,optimisticCount:d}},onSuccess:(c,m,i)=>{i.optimisticReacted?p(b.reactionAdded,{type:e}):p(b.reactionRemoved,{type:e})},onError:c=>{q(y.reactionToggleError,{error:c})},onSettled:async()=>{await k.invalidateQueries({queryKey:n})}})};function F(t){return t==="like"?v:t==="dislike"?R:t==="hot"?_:j}function M(t){return t==="like"?"Like":t==="dislike"?"Dislike":t==="hot"?"Hot":"Sequel Request"}function N(t,e){return e?t==="like"?"from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 dark:from-blue-400 dark:to-blue-500 dark:hover:from-blue-500 dark:hover:to-blue-600":t==="dislike"?"from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 dark:from-red-400 dark:to-red-500 dark:hover:from-red-500 dark:hover:to-red-600":t==="hot"?"from-pink-400 to-pink-500 hover:from-pink-500 hover:to-pink-600 dark:from-pink-400 dark:to-pink-500 dark:hover:from-pink-500 dark:hover:to-pink-600":"from-amber-400 to-amber-500 hover:from-amber-500 hover:to-amber-600 dark:from-amber-400 dark:to-amber-500 dark:hover:from-amber-500 dark:hover:to-amber-600":""}const u=({postId:t,type:e,disabled:s=!1,count:r=0,userReacted:n=!1})=>{const{mutate:c,isPending:m,reset:i}=A({postId:t,type:e,count:r,userReacted:n}),l=()=>{if(m){i();return}c()},{isAuthenticated:d}=H(),a=d&&!s;return o.jsxs("button",{disabled:!a,onClick:l,title:d?"":"You need to register or log in to react.",className:h(`group/btn relative flex items-center gap-2 px-3 py-2
                        rounded-xl font-medium bg-linear-to-r
                        text-mono-700 dark:text-mono-300 shadow-md
                        from-mono-100 to-mono-200 hover:from-mono-200 hover:to-mono-300
                        dark:from-mono-700 dark:to-mono-800 dark:hover:from-mono-600
                        dark:hover:to-mono-700`,N(e,n&&a),n&&a?"text-mono-50 dark:text-mono-50":"",!a&&"opacity-50 cursor-not-allowed bg-mono-300 dark:bg-mono-600 text-mono-500 dark:text-mono-400"),children:[o.jsx(g,{icon:F(e)}),o.jsx("span",{className:"text-sm font-medium",children:M(e)}),o.jsx("span",{className:h("px-1.5 py-0.5 text-xs rounded-full min-w-6 font-semibold bg-mono-300 dark:bg-mono-600 text-mono-700 dark:text-mono-300",n&&a?"bg-mono-100 text-mono-800 group-hover/btn:bg-mono-50 dark:bg-mono-100dark:text-mono-800 dark:group-hover/btn:bg-mono-50":""),children:r})]})},B=({id:t})=>{const{data:e=void 0,isLoading:s}=I({queryKey:["post_reactions",t],queryFn:()=>C(t),staleTime:3e5});return s||!e?o.jsxs("div",{className:"flex flex-wrap gap-2 justify-center my-6",children:[o.jsx(u,{disabled:!0,postId:0,type:"like",count:0,userReacted:!1}),o.jsx(u,{disabled:!0,postId:0,type:"dislike",count:0,userReacted:!1}),o.jsx(u,{disabled:!0,postId:0,type:"hot",count:0,userReacted:!1}),o.jsx(u,{disabled:!0,postId:0,type:"sequel_request",count:0,userReacted:!1})]}):o.jsxs("div",{className:"flex flex-wrap gap-2 justify-center my-6",children:[o.jsx(u,{postId:t,type:"like",count:e.like.count,userReacted:e.like.userHasReacted}),o.jsx(u,{postId:t,type:"dislike",count:e.dislike.count,userReacted:e.dislike.userHasReacted}),o.jsx(u,{postId:t,type:"hot",count:e.hot.count,userReacted:e.hot.userHasReacted}),o.jsx(u,{postId:t,type:"sequel_request",count:e.sequel_request.count,userReacted:e.sequel_request.userHasReacted})]})};export{B as default};
